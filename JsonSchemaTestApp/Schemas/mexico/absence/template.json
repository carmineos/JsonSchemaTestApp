{
  "$id": "/mexico/absence",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$defs": {
    "absenceReasons": {
      "enumNames": [
        "Sick Leave",
        "Vacation"
      ],
      "enum": [
        {
          "name": "Sick Leave",
          "affectingBalance": false,
          "medicalCertificateRequired": true
        },
        {
          "name": "Vacation",
          "affectingBalance": true,
          "medicalCertificateRequired": false
        }
      ]
    },
    "absenceTypes": {
      "type": "string",
      "enum": [
        "Half Day",
        "Full Day"
      ]
    }
  },
  "type": "object",
  "properties": {
    "runtimeData": {
      "$ref": "/common/runtimeData"
    },
    "requestData": {
      "type": "object",
      "properties": {
        "reason": {
          "title": "Reason",
          "type": "object",
          "$ref": "#/$defs/absenceReasons"
        },
        "medicalCertificate": {
          "title": "Medical Certificate",
          "type": "string",
          "format": "data-url"
        },
        "leavePeriod": {
          "$ref": "/common/dateRange"
        },
        "type": {
          "title": "Type",
          "type": "string",
          "$ref": "#/$defs/absenceTypes"
        },
        "traveledDays": {
          "title": "Traveled Days",
          "type": "number"
        },
        "pausePeriod": {
          "$ref": "/common/dateRange"
        },
        "traveledDaysEditedByHR": {
          "title": "Traveled Days Edited By HR",
          "type": "number"
        },
        "travelDays": {
          "title": "Travel Days",
          "type": "boolean"
        },
        "departurePeriod": {
          "$ref": "/common/dateRange"
        },
        "arrivalPeriod": {
          "$ref": "/common/dateRange"
        }
      },
      "required": [
        "reason",
        "leavePeriod",
        "type",
        "traveledDays"
      ]
    }
  },
  "required": [
    "runtimeData",
    "requestData"
  ],
  "allOf": [
    {
      "if": { "properties": { "runtimeData": { "properties": { "workflowData": { "properties": { "currentStep": { "not": { "const": "HR Review" } } } } } } } },
      "then": { "properties": { "requestData": { "properties": { "traveledDaysEditedByHR": { "readOnly": true } } } } }
    },
    {
      "if": { "properties": { "runtimeData": { "properties": { "workflowData": { "properties": { "currentStep": { "const": "Approved" } } } } } } },
      "then": { "properties": { "requestData": { "readOnly": true } } }
    },
    {
      "if": { "properties": { "requestData": { "properties": { "reason": { "properties": { "medicalCertificateRequired": { "const": true } } } } } } },
      "then": { "properties": { "requestData": { "required": [ "medicalCertificate" ] } } },
      "else": { "properties": { "requestData": { "properties": { "medicalCertificate": { "readOnly": true } } } } }
    }
  ]
}